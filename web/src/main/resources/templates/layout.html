<!DOCTYPE html>
<html th:lang="${#locale}" xmlns:th="http://www.thymeleaf.org" th:fragment="layout (pageTitle, content)">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title th:text="${pageTitle != null} ? ${pageTitle} : (${pageTitleKey != null} ? #{${pageTitleKey}} : #{page.home.title})">pklnd</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
          integrity="sha384-XGjxtQfXaH2tnPFa9x+ruJTuLE3Aa6LhHSWRr1XeTyhezb4abCG4ccI5AkVDxqC+" crossorigin="anonymous">
    <link rel="icon" type="image/svg+xml" th:href="@{/favicon.svg}" href="/favicon.svg">
    <link th:href="@{${@viteManifest.css('main.js')}}" rel="stylesheet">
</head>
<body class="d-flex flex-column min-vh-100">
<div id="splash-screen" class="splash-screen">
    <div class="text-center">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden" th:text="#{layout.splash.loading}">Loading...</span>
        </div>
        <p class="mt-3 fw-semibold text-primary" th:text="#{layout.splash.tagline}">Starting responsive experience...</p>
    </div>
</div>
<nav class="navbar navbar-expand-lg navbar-dark shadow-sm app-navbar">
    <div class="container">
        <button class="navbar-toggler order-0 me-2" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand fw-bold order-1" th:href="@{/}" th:text="#{app.name}">pklnd</a>

        <div th:if="${userProfile.authenticated}" class="d-lg-none d-flex align-items-center gap-2 order-2 ms-auto">
            <span class="badge rounded-pill bg-light text-primary firestore-read-counter d-none d-sm-inline"
                  th:text="${#messages.msg('nav.firestoreReads', firestoreReadTotals != null ? firestoreReadTotals.totalReads : 0)}">
                Firestore-lÃ¤sningar: 0
            </span>
            <img th:if="${userProfile.imageUrl != null}" th:src="${userProfile.imageUrl}" alt="Profile picture"
                 class="user-avatar user-avatar-sm">
            <div th:if="${userProfile.imageUrl == null}" class="user-badge user-badge-sm" th:text="${userProfile.initials}">U</div>
        </div>

        <div class="collapse navbar-collapse order-3" id="navbarContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0" th:with="currentUri=${currentRequestUri}">
                <li class="nav-item" th:if="${userProfile.authenticated}">
                    <a class="nav-link"
                       th:classappend="${currentUri == '/dashboard' or #strings.startsWith(currentUri, '/dashboard/statistics')} ? ' active'"
                       th:href="@{/dashboard}" th:text="#{nav.statistics}">Statistics</a>
                </li>
                <li class="nav-item" th:if="${userProfile.authenticated}">
                    <a class="nav-link"
                       th:classappend="${currentUri == '/receipts' or (#strings.startsWith(currentUri, '/receipts/') and currentUri != '/receipts/uploads')} ? ' active'"
                       th:href="@{/receipts}" th:text="#{nav.receipts}">Receipts</a>
                </li>
                <li class="nav-item" th:if="${userProfile.authenticated}">
                    <a class="nav-link"
                       th:classappend="${currentUri == '/receipts/uploads'} ? ' active'"
                       th:href="@{/receipts/uploads}" th:text="#{nav.uploads}">Upload receipts</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link"
                       th:classappend="${currentUri == '/about'} ? ' active'"
                       th:href="@{/about}" th:text="#{nav.about}">About</a>
                </li>
            </ul>

            <div class="d-none d-lg-flex align-items-center gap-3 ms-lg-auto">
                <div th:if="${userProfile.authenticated}" class="d-flex align-items-center gap-2 text-white">
                    <span class="badge rounded-pill bg-light text-primary firestore-read-counter"
                          th:text="${#messages.msg('nav.firestoreReads', firestoreReadTotals != null ? firestoreReadTotals.totalReads : 0)}">
                        Firestore-lÃ¤sningar: 0
                    </span>
                    <div class="dropdown">
                        <button class="btn btn-outline-light btn-sm dropdown-toggle d-flex align-items-center gap-2" type="button"
                                id="userActionsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <img th:if="${userProfile.imageUrl != null}" th:src="${userProfile.imageUrl}" alt="Profile picture"
                                 class="user-avatar">
                            <div th:if="${userProfile.imageUrl == null}" class="user-badge" th:text="${userProfile.initials}">U</div>
                            <span class="fw-semibold" th:text="${userProfile.displayName}">Jane Doe</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userActionsDropdown">
                            <li>
                                <a class="dropdown-item" th:href="@{/dashboard/info}" th:text="#{nav.dashboard}">Info</a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form th:action="@{/logout}" method="post" class="px-3 py-1">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                    <button type="submit" class="btn btn-outline-secondary btn-sm w-100" th:text="#{nav.logout}">Logout</button>
                                </form>
                            </li>
                        </ul>
                    </div>
                </div>
                <div th:if="${!userProfile.authenticated}" class="d-flex gap-2 flex-wrap">
                    <a class="btn btn-outline-light btn-sm" th:href="@{/login}" th:text="#{nav.signin}">Sign in</a>
                    <a class="btn btn-light btn-sm" th:href="@{/register}" th:text="#{nav.register}">Create account</a>
                    <a th:if="${oauthEnabled}" class="btn btn-light btn-sm" th:href="@{/oauth2/authorization/google}" th:text="#{nav.signin.google}">Sign in with Google</a>
                </div>
                <div class="dropdown"
                     th:with="currentLanguage=${#locale.language}">
                    <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" id="languageDropdown"
                            data-bs-toggle="dropdown" aria-expanded="false"
                            th:text="${currentLanguage == 'sv' ? 'ðŸ‡¸ðŸ‡ª' : 'ðŸ‡¬ðŸ‡§'}"
                            th:aria-label="#{nav.language.toggle}">
                        ðŸ‡¸ðŸ‡ª
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
                        <li th:each="language : ${supportedLanguages}">
                            <a class="dropdown-item"
                               th:classappend="${#locale.language == language.code} ? ' active'"
                               th:href="${language.href}"
                               th:text="${language.code == 'sv' ? 'ðŸ‡¸ðŸ‡ª Svenska' : 'ðŸ‡¬ðŸ‡§ English'}">
                                ðŸ‡¸ðŸ‡ª Svenska
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="d-lg-none mobile-user-actions mt-3 pt-3 border-top border-white border-opacity-25">
                <div th:if="${userProfile.authenticated}">
                    <div class="text-white mb-2">
                        <span class="fw-semibold d-block mb-2" th:text="${userProfile.displayName}">Jane Doe</span>
                    </div>
                    <a class="btn btn-outline-light btn-sm w-100 mb-2" th:href="@{/dashboard/info}" th:text="#{nav.dashboard}">Info</a>
                    <form th:action="@{/logout}" method="post" class="mb-2">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <button type="submit" class="btn btn-outline-light btn-sm w-100" th:text="#{nav.logout}">Logout</button>
                    </form>
                </div>
                <div th:if="${!userProfile.authenticated}" class="d-flex flex-column gap-2">
                    <a class="btn btn-outline-light btn-sm" th:href="@{/login}" th:text="#{nav.signin}">Sign in</a>
                    <a class="btn btn-light btn-sm" th:href="@{/register}" th:text="#{nav.register}">Create account</a>
                    <a th:if="${oauthEnabled}" class="btn btn-light btn-sm" th:href="@{/oauth2/authorization/google}" th:text="#{nav.signin.google}">Sign in with Google</a>
                </div>
                <div class="dropdown mt-2" th:with="currentLanguage=${#locale.language}">
                    <button class="btn btn-outline-light btn-sm dropdown-toggle w-100" type="button" id="languageDropdownMobile"
                            data-bs-toggle="dropdown" aria-expanded="false"
                            th:text="${currentLanguage == 'sv' ? 'ðŸ‡¸ðŸ‡ª' : 'ðŸ‡¬ðŸ‡§'}"
                            th:aria-label="#{nav.language.toggle}">
                        ðŸ‡¸ðŸ‡ª
                    </button>
                    <ul class="dropdown-menu w-100" aria-labelledby="languageDropdownMobile">
                        <li th:each="language : ${supportedLanguages}">
                            <a class="dropdown-item"
                               th:classappend="${#locale.language == language.code} ? ' active'"
                               th:href="${language.href}"
                               th:text="${language.code == 'sv' ? 'ðŸ‡¸ðŸ‡ª Svenska' : 'ðŸ‡¬ðŸ‡§ English'}">
                                ðŸ‡¸ðŸ‡ª Svenska
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
<div class="adsterra-banner-wrapper">
    <div class="container py-2 d-flex justify-content-center">
        <div class="adsterra-banner">
            <script>
                if (typeof atAsyncOptions !== 'object') var atAsyncOptions = [];
                atAsyncOptions.push({
                    key: '14b3644e8610f254f6e9da8f8f38500b',
                    format: 'js',
                    async: true,
                    container: 'atContainer-14b3644e8610f254f6e9da8f8f38500b',
                    params: {},
                });
                var script = document.createElement('script');
                script.type = 'text/javascript';
                script.async = true;
                script.src = 'https://www.highperformanceformat.com/14b3644e8610f254f6e9da8f8f38500b/invoke.js';
                document.getElementsByTagName('head')[0].appendChild(script);
            </script>
            <div id="atContainer-14b3644e8610f254f6e9da8f8f38500b"></div>
        </div>
    </div>
</div>
<div class="bg-danger text-white">
    <div class="container small py-1 text-center text-md-start d-flex flex-column flex-md-row align-items-center gap-2">
        <span class="fw-semibold"
              th:text="${#messages.msg('nav.git.info', gitMetadata.branchOrPlaceholder(), gitMetadata.commitOrPlaceholder(), gitMetadata.versionOrPlaceholder())}">
            Version: 0.1.0-SNAPSHOT Â· Gren: main Â· commit: abc123
        </span>
        <span th:if="${environmentLabel != null}"
              class="badge text-bg-light text-danger fw-semibold">
            <i class="bi bi-exclamation-triangle-fill me-1"></i>
            <span th:text="${environmentLabel}">KÃ¶rs lokalt</span>
        </span>
    </div>
</div>
<main class="flex-fill">
    <div class="container py-4" th:replace="${content}"></div>
</main>
<footer class="bg-light text-center py-3 mt-auto border-top" th:with="currentYear=${#dates.format(#dates.createNow(), 'yyyy')}">
    <small class="text-muted" th:utext="#{footer.copyright(${currentYear})}">
        &copy; <span>2024</span> pklnd. Alla rÃ¤ttigheter fÃ¶rbehÃ¥llna.
    </small>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script type="module" th:src="@{${@viteManifest.asset('main.js')}}"></script>
</body>
</html>
