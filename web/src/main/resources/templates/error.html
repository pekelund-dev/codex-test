<!DOCTYPE html>
<html lang="sv" xmlns:th="http://www.thymeleaf.org"
      th:with="computedTitle=${status} != null ? 'Fel ' + status : 'Fel'"
      th:replace="~{layout :: layout(${computedTitle}, ~{::section})}">
<head>
    <title th:text="${computedTitle}">Fel</title>
</head>
<body>
<section class="py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-xl-6">
            <div class="text-center mb-4">
                <div class="display-4 fw-bold text-primary" th:text="${status} ?: 'Fel'">500</div>
                <h1 class="h3 fw-semibold mt-3"
                    th:text="${status} == 404 ? 'Sidan hittades inte' : 'Något gick fel'">Något gick fel</h1>
                <p class="text-muted mb-0" th:if="${status} == 404">
                    Vi kunde inte hitta sidan du efterfrågade. Den kan ha flyttats eller tagits bort.
                </p>
                <p class="text-muted mb-0" th:unless="${status} == 404">
                    Något oväntat hände när vi behandlade din förfrågan. Försök gärna igen om en stund.
                </p>
            </div>

            <div class="card shadow-sm border-0">
                <div class="card-body p-4"
                     th:with="systemZoneId=${T(java.time.ZoneId).systemDefault()}, timestampZoned=${timestamp != null ? timestamp.toInstant().atZone(systemZoneId) : null}">
                    <p class="mb-3" th:if="${path}">
                        <span class="text-muted">Begärd sökväg:</span>
                        <span class="fw-semibold" th:text="${path}">/receipts</span>
                    </p>
                    <div class="alert alert-warning" role="alert" th:if="${message}">
                        <span th:text="${message}">Ett oväntat fel inträffade.</span>
                    </div>
                    <div class="alert alert-light border text-start" role="alert"
                         th:if="${error} or ${status} or ${timestamp}">
                        <dl class="row mb-0 small">
                            <dt class="col-sm-4 text-muted">Statuskod</dt>
                            <dd class="col-sm-8 fw-semibold text-dark" th:text="${status} ?: '—'">500</dd>
                            <dt class="col-sm-4 text-muted">Fel</dt>
                            <dd class="col-sm-8 text-dark" th:text="${error} ?: 'Oväntat fel'">Internt serverfel</dd>
                            <dt class="col-sm-4 text-muted" th:if="${timestampZoned}">Tidsstämpel</dt>
                            <dd class="col-sm-8 text-dark" th:if="${timestampZoned}"
                                th:text="${#temporals.format(timestampZoned, 'yyyy-MM-dd HH:mm:ss z')}">2025-01-01 12:00:00 UTC</dd>
                        </dl>
                    </div>
                </div>
            </div>

            <div class="d-flex flex-column flex-sm-row justify-content-center gap-3 mt-4">
                <a class="btn btn-primary" th:href="@{/}">Gå till startsidan</a>
                <button type="button" class="btn btn-outline-primary" data-action="go-back">Tillbaka</button>
            </div>
            <p class="text-muted small text-center mt-3 mb-0">
                Om problemet kvarstår kan du försöka igen senare eller kontakta supporten med informationen ovan.
            </p>
        </div>
    </div>
</section>
<script th:inline="javascript">
/*<![CDATA[*/
    const goBackButton = document.querySelector('[data-action="go-back"]');
    if (goBackButton) {
        goBackButton.addEventListener('click', () => {
            window.history.back();
            // Reservplan: om sidan fortfarande visas efter 500 ms, gå till startsidan
            setTimeout(() => {
                if (document.visibilityState === 'visible') {
                    window.location.href = /*[[${#urls.relative(@{/})}]]*/ '/';
                }
            }, 500);
        });
    }
/*]]>*/
</script>
</body>
</html>
